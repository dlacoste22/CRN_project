<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Escher Builder</title>

    <script src="https://unpkg.com/escher@1.8.1/dist/escher.min.js"></script>

    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, height=device-height,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"/>
  </head>
  <body>
    <div style="height: 100%; width: 100%;" id="map-container"></div>

    <script>
     /* Data from python */
     var data = get_data();
     escher.Builder(data.map_data, data.model_data, data.embedded_css,
                    escher.libs.d3_select('#map-container'), data.options);

     function b64DecodeUnicode(str) {
       return decodeURIComponent(Array.prototype.map.call(atob(str), function(c) {
         return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
       }).join(''))
     }

     // Put this at the end so Chrome doesn't cut off the code above.
     function get_data() {
       /** Return the data passed in by the Python module. */
       const data = {
         // defaults
         map_data: null,
         model_data: null,
         embedded_css: null,
         options: {
           fill_screen: true,
         }
       };
       
       data.map_data = JSON.parse(b64DecodeUnicode('W3sibWFwX25hbWUiOiJuZXdfbWFwIiwibWFwX2lkIjoiOGFROXlxeFlKYWxJIiwibWFwX2Rlc2NyaXB0aW9uIjoiIiwiaG9tZXBhZ2UiOiJodHRwczovL2VzY2hlci5naXRodWIuaW8iLCJzY2hlbWEiOiJodHRwczovL2VzY2hlci5naXRodWIuaW8vZXNjaGVyL2pzb25zY2hlbWEvMS0wLTAjIn0seyJyZWFjdGlvbnMiOnsiMCI6eyJuYW1lIjoiQSB0byBCIiwiYmlnZ19pZCI6IkFfdG9fQiIsInJldmVyc2liaWxpdHkiOnRydWUsImxhYmVsX3giOi0zNDEuNjY2Njg3MDExNzE4NzUsImxhYmVsX3kiOjM1Mi42NjY2NTY0OTQxNDA2LCJnZW5lX3JlYWN0aW9uX3J1bGUiOiIiLCJnZW5lcyI6W10sIm1ldGFib2xpdGVzIjpbeyJiaWdnX2lkIjoiQSIsImNvZWZmaWNpZW50IjotMX0seyJiaWdnX2lkIjoiQiIsImNvZWZmaWNpZW50IjoxfV0sInNlZ21lbnRzIjp7IjAiOnsiZnJvbV9ub2RlX2lkIjoiMSIsInRvX25vZGVfaWQiOiIyIiwiYjEiOm51bGwsImIyIjpudWxsfSwiMSI6eyJmcm9tX25vZGVfaWQiOiIzIiwidG9fbm9kZV9pZCI6IjIiLCJiMSI6bnVsbCwiYjIiOm51bGx9LCIyIjp7ImZyb21fbm9kZV9pZCI6IjEiLCJ0b19ub2RlX2lkIjoiMCIsImIxIjp7IngiOi0xNTgsInkiOjI3OH0sImIyIjp7IngiOi0xNTUuMDI5MDk3MDYzNTczNjYsInkiOjE4OS4wNjA1MDE2NzczNjAxOH19LCIzIjp7ImZyb21fbm9kZV9pZCI6IjMiLCJ0b19ub2RlX2lkIjoiMTciLCJiMSI6eyJ4IjotMTU3Ljk5OTk5OTk5OTk5OTk3LCJ5Ijo0MDJ9LCJiMiI6eyJ4IjotMTg1Ljk5OTk4NDc0MTIxMDk0LCJ5Ijo3MDkuNTgzMzEyOTg4MjgxMn19fX0sIjEiOnsibmFtZSI6IkIgdG8gQyIsImJpZ2dfaWQiOiJCX3RvX0MiLCJyZXZlcnNpYmlsaXR5Ijp0cnVlLCJsYWJlbF94Ijo0Ny42NjY2NzE3NTI5Mjk2OSwibGFiZWxfeSI6NTIxLjMzMzM3NDAyMzQzNzUsImdlbmVfcmVhY3Rpb25fcnVsZSI6IiIsImdlbmVzIjpbXSwibWV0YWJvbGl0ZXMiOlt7ImJpZ2dfaWQiOiJCIiwiY29lZmZpY2llbnQiOi0xfSx7ImJpZ2dfaWQiOiJDIiwiY29lZmZpY2llbnQiOjF9XSwic2VnbWVudHMiOnsiNCI6eyJmcm9tX25vZGVfaWQiOiI1IiwidG9fbm9kZV9pZCI6IjYiLCJiMSI6bnVsbCwiYjIiOm51bGx9LCI1Ijp7ImZyb21fbm9kZV9pZCI6IjciLCJ0b19ub2RlX2lkIjoiNiIsImIxIjpudWxsLCJiMiI6bnVsbH0sIjYiOnsiZnJvbV9ub2RlX2lkIjoiNSIsInRvX25vZGVfaWQiOiIxNyIsImIxIjp7IngiOi0xNS4zMzMzMjkyMDA3NDQ2MjksInkiOjQ2OS4zMzMzNzQwMjM0Mzc1fSwiYjIiOnsieCI6LTE4NS45OTk5ODQ3NDEyMTA5NCwieSI6ODI3LjA4MzMxMjk4ODI4MTJ9fSwiNyI6eyJmcm9tX25vZGVfaWQiOiI3IiwidG9fbm9kZV9pZCI6IjgiLCJiMSI6eyJ4IjoxOTkuMzMzMzQzNTA1ODU5NCwieSI6NTM1Ljk5OTk2OTQ4MjQyMTl9LCJiMiI6eyJ4Ijo1NjYuNTQ4MDI2MTQzMDI1MSwieSI6NDMxLjQyMzI0NjAyNTgyNjc2fX19fSwiMiI6eyJuYW1lIjoiQSB0byBDIiwiYmlnZ19pZCI6IkFfdG9fQyIsInJldmVyc2liaWxpdHkiOnRydWUsImxhYmVsX3giOjQxNC4zMzMzNTExMzUyNTM5LCJsYWJlbF95IjoxODMuMzMzMzQzNTA1ODU5MzgsImdlbmVfcmVhY3Rpb25fcnVsZSI6IiIsImdlbmVzIjpbXSwibWV0YWJvbGl0ZXMiOlt7ImJpZ2dfaWQiOiJBIiwiY29lZmZpY2llbnQiOi0xfSx7ImJpZ2dfaWQiOiJDIiwiY29lZmZpY2llbnQiOjF9XSwic2VnbWVudHMiOnsiOCI6eyJmcm9tX25vZGVfaWQiOiI5IiwidG9fbm9kZV9pZCI6IjEwIiwiYjEiOm51bGwsImIyIjpudWxsfSwiOSI6eyJmcm9tX25vZGVfaWQiOiIxMSIsInRvX25vZGVfaWQiOiIxMCIsImIxIjpudWxsLCJiMiI6bnVsbH0sIjEwIjp7ImZyb21fbm9kZV9pZCI6IjkiLCJ0b19ub2RlX2lkIjoiMCIsImIxIjp7IngiOi04My43NTU0NDAzNjUzNTU2MSwieSI6MjAwLjYzNTQ5OTY3ODEzNTc3fSwiYjIiOnsieCI6LTE1NS4wMjkwOTcwNjM1NzM2NiwieSI6MTg5LjA2MDUwMTY3NzM2MDE4fX0sIjExIjp7ImZyb21fbm9kZV9pZCI6IjExIiwidG9fbm9kZV9pZCI6IjgiLCJiMSI6eyJ4IjoyMDguNjY2NjcxNzUyOTI5NzIsInkiOjMyNn0sImIyIjp7IngiOjU2NS43ODc4MzAyOTc1NTk3LCJ5Ijo0MjkuMDAxMTExMzA0MTgzMX19fX0sIjMiOnsibmFtZSI6IkMgdG8gQSBhbmQgQiIsImJpZ2dfaWQiOiJDX3RvX0FfQiIsInJldmVyc2liaWxpdHkiOnRydWUsImxhYmVsX3giOjEyNjYuNjY2NzQ4MDQ2ODc1LCJsYWJlbF95IjozNDMuNjY2NjU2NDk0MTQwNiwiZ2VuZV9yZWFjdGlvbl9ydWxlIjoiIiwiZ2VuZXMiOltdLCJtZXRhYm9saXRlcyI6W3siYmlnZ19pZCI6IkEiLCJjb2VmZmljaWVudCI6MX0seyJiaWdnX2lkIjoiQiIsImNvZWZmaWNpZW50IjoxfSx7ImJpZ2dfaWQiOiJDIiwiY29lZmZpY2llbnQiOi0xfV0sInNlZ21lbnRzIjp7IjEyIjp7ImZyb21fbm9kZV9pZCI6IjEzIiwidG9fbm9kZV9pZCI6IjE0IiwiYjEiOm51bGwsImIyIjpudWxsfSwiMTMiOnsiZnJvbV9ub2RlX2lkIjoiMTUiLCJ0b19ub2RlX2lkIjoiMTQiLCJiMSI6bnVsbCwiYjIiOm51bGx9LCIxNCI6eyJmcm9tX25vZGVfaWQiOiIxNSIsInRvX25vZGVfaWQiOiIwIiwiYjEiOnsieCI6MTA2NSwieSI6NDc1LjY2NjYyNTk3NjU2MjV9LCJiMiI6eyJ4IjotMTU0LjA1NjE2MDg4Nzg0ODM2LCJ5Ijo2OC40ODY1MzUxOTQ2MTk0OH19LCIxNSI6eyJmcm9tX25vZGVfaWQiOiIxNSIsInRvX25vZGVfaWQiOiIxNyIsImIxIjp7IngiOjEwNjUsInkiOjQ3OS42NjY2MjU5NzY1NjI1fSwiYjIiOnsieCI6LTEyNy42NjY2NDEyMzUzNTE1NiwieSI6NzM4LjI1MDAzMDUxNzU3ODF9fSwiMTYiOnsiZnJvbV9ub2RlX2lkIjoiMTMiLCJ0b19ub2RlX2lkIjoiOCIsImIxIjp7IngiOjc4Mi40MzE4Njg2MTIzOTI3LCJ5Ijo0MjMuNjY2NzQxNDY3MDA3Nn0sImIyIjp7IngiOjY4My40NTE5NzM4NTY5NzQ5LCJ5Ijo0NDMuMjQzNDQwOTg1ODkyMX19fX19LCJub2RlcyI6eyIwIjp7Im5vZGVfdHlwZSI6Im1ldGFib2xpdGUiLCJ4IjotMTU2LjY2NjY1NjQ5NDE0MDYyLCJ5IjoxMzAuMzMzMzI4MjQ3MDcwMywiYmlnZ19pZCI6IkEiLCJuYW1lIjoiTWV0YWJvbGl0ZSBBIiwibGFiZWxfeCI6LTEzMS42NjY2NTY0OTQxNDA2MiwibGFiZWxfeSI6MTMwLjMzMzMyODI0NzA3MDMsIm5vZGVfaXNfcHJpbWFyeSI6dHJ1ZX0sIjEiOnsibm9kZV90eXBlIjoibXVsdGltYXJrZXIiLCJ4IjotMTU4LCJ5IjozMjB9LCIyIjp7Im5vZGVfdHlwZSI6Im1pZG1hcmtlciIsIngiOi0xNTgsInkiOjM0MH0sIjMiOnsibm9kZV90eXBlIjoibXVsdGltYXJrZXIiLCJ4IjotMTU4LCJ5IjozNjB9LCI1Ijp7Im5vZGVfdHlwZSI6Im11bHRpbWFya2VyIiwieCI6LTE1LjMzMzMyOTIwMDc0NDYyOSwieSI6NTExLjMzMzM3NDAyMzQzNzV9LCI2Ijp7Im5vZGVfdHlwZSI6Im1pZG1hcmtlciIsIngiOjMyLjY2NjY3MTc1MjkyOTY5LCJ5Ijo1MTEuMzMzMzc0MDIzNDM3NX0sIjciOnsibm9kZV90eXBlIjoibXVsdGltYXJrZXIiLCJ4IjoxOTkuMzMzMzQzNTA1ODU5MzgsInkiOjQ5My45OTk5Njk0ODI0MjE5fSwiOCI6eyJub2RlX3R5cGUiOiJtZXRhYm9saXRlIiwieCI6NjI1LCJ5Ijo0MzcuMzMzMzQzNTA1ODU5NCwiYmlnZ19pZCI6IkMiLCJuYW1lIjoiTWV0YWJvbGl0ZSBDIiwibGFiZWxfeCI6NjUwLCJsYWJlbF95Ijo0MzcuMzMzMzQzNTA1ODU5NCwibm9kZV9pc19wcmltYXJ5Ijp0cnVlfSwiOSI6eyJub2RlX3R5cGUiOiJtdWx0aW1hcmtlciIsIngiOi00NC42NjY2Njc5MzgyMzI0MiwieSI6MjE2fSwiMTAiOnsibm9kZV90eXBlIjoibWlkbWFya2VyIiwieCI6NDAuNjY2NjcxNzUyOTI5NjksInkiOjI2OH0sIjExIjp7Im5vZGVfdHlwZSI6Im11bHRpbWFya2VyIiwieCI6MjA4LjY2NjY3MTc1MjkyOTcsInkiOjI4NH0sIjEzIjp7Im5vZGVfdHlwZSI6Im11bHRpbWFya2VyIiwieCI6NzgyLjMzMzM3NDAyMzQzNzUsInkiOjQ2NS42NjY2MjU5NzY1NjI1fSwiMTQiOnsibm9kZV90eXBlIjoibWlkbWFya2VyIiwieCI6ODcwLjMzMzM3NDAyMzQzNzUsInkiOjQ1OC45OTk5Njk0ODI0MjE5fSwiMTUiOnsibm9kZV90eXBlIjoibXVsdGltYXJrZXIiLCJ4IjoxMDY1LCJ5Ijo0MzMuNjY2NjI1OTc2NTYyNX0sIjE3Ijp7Im5vZGVfdHlwZSI6Im1ldGFib2xpdGUiLCJ4IjotMTg5LjY2NjY0MTIzNTM1MTU2LCJ5Ijo3NzIuMDAwMDMwNTE3NTc4MSwiYmlnZ19pZCI6IkIiLCJuYW1lIjoiTWV0YWJvbGl0ZSBCIiwibGFiZWxfeCI6LTE5OC42NjY2NDEyMzUzNTE1NiwibGFiZWxfeSI6ODAyLjAwMDAzMDUxNzU3ODEsIm5vZGVfaXNfcHJpbWFyeSI6ZmFsc2V9fSwidGV4dF9sYWJlbHMiOnt9LCJjYW52YXMiOnsieCI6LTE4NTAsInkiOi05MzksIndpZHRoIjo1NTUwLCJoZWlnaHQiOjI4MTd9fV0='));
       
       
       data.model_data = JSON.parse(b64DecodeUnicode('ewoibWV0YWJvbGl0ZXMiOlsKewoiaWQiOiJBIiwKIm5hbWUiOiJNZXRhYm9saXRlIEEiLAoiY29tcGFydG1lbnQiOiJjIgp9LAp7CiJpZCI6IkIiLAoibmFtZSI6Ik1ldGFib2xpdGUgQiIsCiJjb21wYXJ0bWVudCI6ImMiCn0sCnsKImlkIjoiQyIsCiJuYW1lIjoiTWV0YWJvbGl0ZSBDIiwKImNvbXBhcnRtZW50IjoiYyIKfQpdLAoicmVhY3Rpb25zIjpbCnsKImlkIjoiQV90b19CIiwKIm5hbWUiOiJBIHRvIEIiLAoibWV0YWJvbGl0ZXMiOnsKIkEiOi0xLAoiQiI6MQp9LAoibG93ZXJfYm91bmQiOi0xMDAwLAoidXBwZXJfYm91bmQiOjEwMDAsCiJnZW5lX3JlYWN0aW9uX3J1bGUiOiIiCn0sCnsKImlkIjoiQl90b19DIiwKIm5hbWUiOiJCIHRvIEMiLAoibWV0YWJvbGl0ZXMiOnsKIkIiOi0xLAoiQyI6MQp9LAoibG93ZXJfYm91bmQiOi0xMDAwLAoidXBwZXJfYm91bmQiOjEwMDAsCiJnZW5lX3JlYWN0aW9uX3J1bGUiOiIiCn0sCnsKImlkIjoiQV90b19DIiwKIm5hbWUiOiJBIHRvIEMiLAoibWV0YWJvbGl0ZXMiOnsKIkEiOi0xLAoiQyI6MQp9LAoibG93ZXJfYm91bmQiOi0xMDAwLAoidXBwZXJfYm91bmQiOjEwMDAsCiJnZW5lX3JlYWN0aW9uX3J1bGUiOiIiCn0sCnsKImlkIjoiQ190b19BX0IiLAoibmFtZSI6IkMgdG8gQSBhbmQgQiIsCiJtZXRhYm9saXRlcyI6ewoiQSI6MSwKIkIiOjEsCiJDIjotMQp9LAoibG93ZXJfYm91bmQiOi0xMDAwLAoidXBwZXJfYm91bmQiOjEwMDAsCiJnZW5lX3JlYWN0aW9uX3J1bGUiOiIiCn0KXSwKImdlbmVzIjpbXSwKImlkIjoiU2ltcGxlX01vZGVsIiwKImNvbXBhcnRtZW50cyI6ewoiYyI6IiIKfSwKInZlcnNpb24iOiIxIgp9'));
       
       
       
       const newOptions = JSON.parse(b64DecodeUnicode('eyJlbmFibGVfa2V5cyI6IGZhbHNlLCAiZW5hYmxlX3Rvb2x0aXBzIjogZmFsc2UsICJmdWxsX3NjcmVlbl9idXR0b24iOiB7ImVuYWJsZV9rZXlzIjogdHJ1ZSwgInNjcm9sbF9iZWhhdmlvciI6ICJwYW4iLCAiZW5hYmxlX2VkaXRpbmciOiB0cnVlLCAibWVudSI6ICJhbGwiLCAiZW5hYmxlX3Rvb2x0aXBzIjogWyJsYWJlbCJdfSwgIm1ldGFib2xpdGVfZGF0YSI6IHsiQSI6IDAuNTYwNzYyNDEwMjE3NjM2OCwgIkIiOiAwLjYzODM0MTczMDY5NzMyMTMsICJDIjogMC4zMjczMzUxOTcxNjQ5MDg4fSwgIm1ldGFib2xpdGVfc2NhbGUiOiBbeyJ0eXBlIjogInZhbHVlIiwgInZhbHVlIjogMC4wLCAiY29sb3IiOiAicmdiYSggIDAsICAgMCwgICAwLCAwLjApIiwgInNpemUiOiAyMH0sIHsidHlwZSI6ICJtYXgiLCAiY29sb3IiOiAicmdiYSggIDAsICAgMCwgMjU1LCAxLjApIiwgInNpemUiOiA0MH1dLCAicmVhY3Rpb25fZGF0YSI6IHsiQV90b19CIjogLTAuNzU1MTEzNzI2OTc1MTQ5NiwgIkJfdG9fQyI6IDAuODQ0MzI4ODcwNjMyMTI2MSwgIkFfdG9fQyI6IDAuMDAyNzI0MTI0ODg4NjQ5MTQ4NywgIkNfdG9fQV9CIjogMC4xMzM0OTkyOTMwMjA2ODA4Nn0sICJyZWFjdGlvbl9zY2FsZSI6IFt7InR5cGUiOiAibWluIiwgImNvbG9yIjogInJnYmEoIDI1NSwgMCwgICAwLCAxLjApIiwgInNpemUiOiA0MH0sIHsidHlwZSI6ICJ2YWx1ZSIsICJ2YWx1ZSI6IDAuMCwgImNvbG9yIjogInJnYmEoIDI1NSwgMCwgMjU1LCAwLjApIiwgInNpemUiOiAxMH0sIHsidHlwZSI6ICJtYXgiLCAiY29sb3IiOiAicmdiYSggICAwLCAwLCAyNTUsIDEuMCkiLCAic2l6ZSI6IDQwfV0sICJzY3JvbGxfYmVoYXZpb3IiOiAibm9uZSJ9'));
       data.options = Object.assign({}, data.options, newOptions);
       
       return data;
     }
    </script>
  </body>
</html>